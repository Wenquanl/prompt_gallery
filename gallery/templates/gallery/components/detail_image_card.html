<div class="{% if img.is_video %}col-12 video-wide-item{% else %}col-6 col-md-4 col-lg-3{% endif %} mb-4 grid-item" id="img-anchor-{{ img.pk }}">
    <div class="detail-img-card shadow-sm position-relative" id="img-card-{{ img.pk }}" style="min-height: 200px; background-color: #f8f9fa;">
        {% if img.image %}
        <span class="file-size-badge">{{ img.image.size|filesizeformat }}</span>
        {% endif %}
        
        <div class="position-relative">
            {% if img.is_video %}
                <div class="ratio" style="--bs-aspect-ratio: 56.25%;">
                    <video 
                        src="{{ img.image.url }}" 
                        class="thumb-img w-100 h-100" 
                        controls 
                        preload="metadata" 
                        disablePictureInPicture
                        controlsList="nodownload noremoteplayback noplaybackrate"
                        oncontextmenu="return false;"
                        style="object-fit: contain; background-color: transparent; border-radius: 12px 12px 0 0; cursor: default;">
                    </video>
                </div>
                <div class="position-absolute top-0 end-0 m-2 d-flex gap-2">
                    <button type="button" class="btn btn-sm btn-dark bg-opacity-75 rounded-circle border-0 d-flex align-items-center justify-content-center" 
                            style="width: 24px; height: 24px;" 
                            onclick="showModal({{ img.pk }})" 
                            title="全屏预览">
                        <i class="bi bi-arrows-fullscreen" style="font-size: 0.8rem;"></i>
                    </button>
                    <span class="badge bg-dark bg-opacity-50 rounded-pill"><i class="bi bi-camera-reels-fill me-1"></i>Video</span>
                </div>
            {% else %}
                <div role="button" onclick="showModal({{ img.pk }})">
                    {% if force_image_url %}
                        <img src="{{ force_image_url }}" class="thumb-img" alt="Artwork" style="width: 100%; display: block; min-height: 150px; object-fit: cover;">
                    {% elif img.thumbnail %}
                        <img src="{{ img.thumbnail.url }}" class="thumb-img" alt="Artwork" style="width: 100%; display: block; min-height: 150px; object-fit: cover;">
                    {% else %}
                        <img src="{{ img.image.url }}" class="thumb-img" alt="Artwork" style="width: 100%; display: block; min-height: 150px; object-fit: cover;">
                    {% endif %}
                    <div class="hover-overlay"><i class="bi bi-zoom-in text-white fs-2"></i></div>
                </div>
            {% endif %}
        </div>

        <div class="img-action-bar">
            <button type="button" class="action-btn like {% if img.is_liked %}active{% endif %}" id="like-btn-{{ img.pk }}" title="喜欢" onclick="toggleImageLike(event, {{ img.pk }})">
                <i class="bi {% if img.is_liked %}bi-heart-fill{% else %}bi-heart{% endif %}"></i>
            </button>
            
            <a href="{{ img.image.url }}" download class="action-btn download" title="下载原文件">
                <i class="bi bi-download"></i>
            </a>
            
            <form action="{% url 'delete_image' img.pk %}" method="post" class="delete-form-confirm" style="display:inline;">
                {% csrf_token %}
                <button type="button" class="action-btn delete" title="删除" onclick="confirmDelete(event)">
                    <i class="bi bi-trash3-fill"></i>
                </button>
            </form>
        </div>
    </div>
</div>