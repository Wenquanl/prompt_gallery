{% load static %}
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>发布作品 - AI 灵感图库</title>
    <link rel="icon" type="image/svg+xml" href="{% static 'gallery/favicon.svg' %}">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <link rel="stylesheet" href="{% static 'gallery/style.css' %}">
</head>
<body>

<div class="container my-5">
    <div class="mb-4">
        <a href="{{ next_url|default:'/' }}" class="btn btn-light rounded-pill px-3 shadow-sm text-secondary" style="background: rgba(255,255,255,0.6); backdrop-filter: blur(5px); border: var(--glass-border);">
            <i class="bi bi-arrow-left me-2"></i>返回
        </a>
    </div>

    <div class="row justify-content-center">
        <div class="col-lg-8">
            <div class="upload-card p-4 p-md-5">
                <h2 class="text-center fw-bold mb-4" style="color: var(--text-main);">
                    <i class="bi bi-cloud-upload text-primary me-2"></i>发布新创作
                </h2>
                
                <form method="post" enctype="multipart/form-data">
                    {% csrf_token %}
                    
                    <input type="hidden" name="next" value="{{ next_url|default:'/' }}">

                    <div class="mb-4">
                        <label class="form-label">作品标题 <span class="text-danger">*</span></label>
                        {{ form.title }}
                        {% if form.title.errors %}<div class="text-danger small mt-1">{{ form.title.errors.0 }}</div>{% endif %}
                    </div>

                    <div class="mb-4">
                        <label class="form-label">上传生成图 <span class="text-danger">*</span></label>
                        {{ form.upload_images }}
                        <div class="form-text">支持批量选择 (JPG, PNG)</div>
                        {% if form.upload_images.errors %}<div class="text-danger small mt-1">{{ form.upload_images.errors.0 }}</div>{% endif %}
                    </div>
                    
                    <div class="mb-4">
                        <label class="form-label">上传参考图 <span class="text-muted small fw-normal">(可选)</span></label>
                        {{ form.upload_references }}
                        <div class="form-text">如果是图生图，可以上传原参考图。</div>
                    </div>

                    <div class="mb-4">
                        <label class="form-label d-block">选择生成模型 <span class="text-danger">*</span></label>
                        <div class="model-selection-area">
                            {% for radio in form.model_info %}
                                {{ radio.tag.as_widget|safe|cut:"class=" }} 
                                <input type="radio" name="{{ radio.data.name }}" value="{{ radio.data.value }}" 
                                       class="model-radio-input" id="{{ radio.id_for_label }}"
                                       {% if radio.data.selected %}checked{% endif %}>
                                <label class="model-radio-label" for="{{ radio.id_for_label }}">
                                    {% if 'Midjourney' in radio.choice_label %}<i class="bi bi-robot me-1"></i>{% endif %}
                                    {{ radio.choice_label }}
                                </label>
                            {% endfor %}
                        </div>
                    </div>

                    <div class="mb-4">
                        <label class="form-label">正向提示词 (Prompt)</label>
                        {{ form.prompt_text }}
                    </div>
                    <div class="mb-4">
                        <label class="form-label">负向提示词 (Negative Prompt)</label>
                        {{ form.negative_prompt }}
                    </div>

                    <div class="mb-5">
                        <label class="form-label d-block">关联标签</label>
                        <div class="tag-selection-area">
                            {% for checkbox in form.tags %}
                                {{ checkbox.tag.as_widget|safe|cut:"class=" }} 
                                <input type="checkbox" name="{{ checkbox.data.name }}" value="{{ checkbox.data.value }}" 
                                       class="tag-check-input" id="{{ checkbox.id_for_label }}"
                                       {% if checkbox.data.selected %}checked{% endif %}>
                                <label class="tag-check-label" for="{{ checkbox.id_for_label }}">
                                    {{ checkbox.choice_label }}
                                </label>
                            {% empty %}
                                <p class="text-muted small">暂无可选标签，请先去后台添加。</p>
                            {% endfor %}
                        </div>
                    </div>

                    <div class="d-grid">
                        <button type="submit" class="btn btn-primary btn-lg rounded-pill shadow-sm py-3 fw-bold" 
                                style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); border: none;">
                            <i class="bi bi-send-fill me-2"></i>立即发布
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>